<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lobby</title>
    <!-- <link rel='stylesheet' href='/stylesheets/style.css' /> -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Raleway:100,200,300,400,500,700,800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel='stylesheet' href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/emojionearea/3.4.1/emojionearea.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.2/animate.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/emojionearea/3.4.1/emojionearea.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qs/6.9.2/qs.min.js"
        integrity="sha256-TDxXjkAUay70ae/QJBEpGKkpVslXaHHayklIVglFRT4=" crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>

    html, body {
            font-family: 'Raleway';
            height: 100%;
            margin: 0px;
        }

        h2 {
            font-size: 18px;
            padding: 10px 20px;
            color: #575ed8;
            font-family: 'Raleway';
        }

        #mario-chat {

            width: 350px;

            margin: 30px auto;

            box-shadow: 1px 3px 5px rgba(0, 0, 0, 0.05);

            border-radius: 2px;

            position: fixed;
            right: 10px;
            bottom: 40px;

            font-family: 'Raleway';

        }


        #chat-window {

            height: 300px;

            overflow: auto;

            background: #f9f9f9;

        }


        #output p {

            padding: 14px 0px;

            margin: 0 20px;

            border-bottom: 1px solid #e9e9e9;

            color: #555;

            font-family: 'Raleway';

            word-break: break-all;

        }


        #feedback p {

            color: #aaa;

            padding: 14px 0px;

            margin: 0 20px;

            font-family: 'Raleway';

        }


        #output strong {

            color: #575ed8;

            font-family: 'Raleway';

        }



        label {

            box-sizing: border-box;

            display: block;

            padding: 10px 20px;

            font-family: 'Raleway';

        }


        input {

            padding: 10px 20px;

            box-sizing: border-box;

            background: #eee;

            border: 0;

            display: block;

            width: 100%;

            background: #fff;

            border-bottom: 1px solid #eee;

            font-family: 'Raleway';

            font-size: 16px;

        }


        button {

            background: #575ed8;

            color: #fff;

            font-size: 18px;

            border: 0;

            padding: 12px 0;

            width: 100%;

            border-radius: 0 0 2px 2px;

            font-family: 'Raleway';

        }

        .chatButton {
            position: fixed;
            width: 50px;
            height: 50px;
            bottom: 10px;
            right: 10px;
            cursor: pointer;
        }

        /* .videoWrapper {
            position: absolute;
            width: 575px;
            height: 265px;
            border: 1px solid black;
            top: 373px;
            left: 805px;
        } */

        .hotspot1 {
            position: absolute;
            top: 400px;
            left: 50px;
            border: 1px solid #000;
            background: #000;
            border-radius: 10px;
            width: 250px;
            height: 75px;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 25px;
            cursor: pointer;
        }

        .hotspot2 {
            position: absolute;
            top: 400px;
            left: 700px;
            border: 1px solid #000;
            background: #000;
            border-radius: 10px;
            width: 250px;
            height: 75px;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 25px;
            cursor: pointer;
        }

        .hideback {
            z-index: -2;

        }

        /* 
        chat design here
         */


        @import url('https://fonts.googleapis.com/css?family=Roboto&display=swap');

        :root {
            --dark-color-a: #667aff;
            --dark-color-b: #7386ff;
            --light-color: #e6e9ff;
            --success-color: #5cb85c;
            --error-color: #d9534f;
        }

        /* * {
	box-sizing: border-box;
	margin: 0;
	padding: 0;
} */

        /* body {
	font-family: 'Roboto', sans-serif;
	font-size: 16px;
	background: var(--light-color);
	margin: 20px;
} */

        ul {
            list-style: none;
        }

        a {
            text-decoration: none;
        }

        .btn {
            cursor: pointer;
            padding: 5px 15px;
            background: var(--light-color);
            color: var(--dark-color-a);
            border: 0;
            font-size: 17px;
            margin: 5px 0;
        }

        /* Chat Page */

        .chat-container {
           
            background: #fff;
            margin: 30px auto;
            overflow: hidden;
            position: fixed;
            width: 500px;
            height: px;
            right: 65px;
            bottom: -20px;
        }

        .chat-header {
            /* display:none !important; */
            background: #eeffee;
            color: #fff;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
            padding: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* .chat-main {
            display: grid;
            grid-template-columns: 1fr 3fr;
        } */

        .chat-sidebar {
            display:none;
            background: var(--dark-color-b);
            color: #fff;
            padding: 20px 20px 60px;
            overflow-y: scroll;
        }

        .chat-sidebar h2 {
            font-size: 20px;
            background: rgba(0, 0, 0, 0.1);
            padding: 10px;
            margin-bottom: 20px;
        }

        .chat-sidebar h3 {
            margin-bottom: 15px;
        }

        .chat-sidebar ul li {
            padding: 10px 0;
        }

        .chat-messages {
            padding: 30px;
            max-height: 290px;
            overflow-y: scroll;
        }

        .chat-messages .message {
            padding: 10px;
            margin-bottom: 15px;
            background-color: var(--light-color);
            border-radius: 5px;
        }

        .chat-messages .message .meta {
            font-size: 15px;
            font-weight: bold;
            color: var(--dark-color-b);
            opacity: 0.7;
            margin-bottom: 7px;
        }

        .chat-messages .message .meta span {
            color: #777;
        }

        .chat-form-container {
            padding: 20px 30px;
            background-color: var(--dark-color-a);
        }

        .chat-form-container form {
            /* display: flex; */
        }

        .chat-form-container input[type='text'] {
            font-size: 16px;
            padding: 5px;
            height: 40px;
            flex: 1;
        }

        /* Join Page */
        .join-container {
            max-width: 500px;
            margin: 80px auto;
            color: #fff;
        }

        .join-header {
            text-align: center;
            padding: 20px;
            background: var(--dark-color-a);
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        .join-main {
            padding: 30px 40px;
            background: var(--dark-color-b);
        }

        .join-main p {
            margin-bottom: 20px;
        }

        .join-main .form-control {
            margin-bottom: 20px;
        }

        .join-main label {
            display: block;
            margin-bottom: 5px;
        }

        .join-main input[type='text'] {
            font-size: 16px;
            padding: 5px;
            height: 40px;
            width: 100%;
        }

        .join-main select {
            font-size: 16px;
            padding: 5px;
            height: 40px;
            width: 100%;
        }

        .join-main .btn {
            margin-top: 20px;
            width: 100%;
        }

        @media (max-width: 700px) {
            .chat-main {
                display: block;
            }

            .chat-sidebar {
                display: none;
            }
        }
        
        .mainscreen{
            border: 1px solid #000;
            width: 100%;
            height: 100%;
            background-image: url('/images/mall.jpg');
            background-size: cover;
        }
        
        .stream-wrapper {
            width: 100%;
            height: 100%;
            border:1px solid #000;
            background-image: url('/images/videobackground.jpg');
            background-size: cover;
            position: relative;
            display: none;
        }

        .videoWrapper {
            position: absolute;
            border:1px solid red;
            width: 1054px;
            height: 446px;
            top:50%;
            left:50%;
            transform: translate(-50%,-50%);
            /* top: 275px;
            left: 450px; */
        }

        @media screen and (max-width: 1054px) { 

            .stream-wrapper {
                background-image: url('/images/mobilebackground.jpg');
            }

            .videoWrapper{
                    width: 100% !important;
                    height: 250px;
                    top: 40%;
                    border: 1px solid #000;
            }
        }

        /* @media screen and (max-width: 800px) { 
            .stream-wrapper {
                background-image: url('/images/mobilebackground.jpg');
            }

            .videoWrapper{
                    width: 100%;
                    height: 427px;
                    top: 265px;
                    left: 0;
                    border: 1px solid #000;
            }
            }

            @media screen and (max-width: 500px) {
            .stream-wrapper {
                background-image: url('/images/mobilebackground.jpg');
            }
            .videoWrapper{
                    width: 100%;
                    height: 225px;
                    top: 140px;
                    left: 0;
                    border: 1px solid #000;
            }
            } */
    

    </style>
</head>

<body>

    <div class="mainscreen" >
        <!-- <img src="images/mall.jpg" width="100%" /> -->
        <div class="hotspot1 animated pulse infinite" onclick="auditorium()">AUDITORIUM</div>
        <div class="hotspot2 animated pulse infinite" onclick="exhibitionhall()">EXHIBITION HALL</div>
    </div>

    <div class="stream-wrapper">

            <div class="videoWrapper">
                <iframe width="100%" height="100%" src="https://www.youtube.com/embed/jYUsd1Jhizc" 
                frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
            </div>

         <div class="chatButton" onclick="chatboxtoggle()">
            <img src="https://img.icons8.com/cotton/64/000000/filled-chat--v1.png" width="100%" />
        </div>

        <!-- chat logic start here -->
        <!-- live chat over here -->

         <div class="chat-container animated fadeIn" style="z-index: 100; display: none;">
            <header class="chat-header">
                
            </header>

            <main class="chat-main">
                <div class="chat-sidebar">
                    <h3><i class="fas fa-comments"></i> Room Name:</h3>
                    <h2 id="room-name"></h2>
                    <h3><i class="fas fa-users"></i> Users</h3>
                    <ul id="users"></ul>
                </div>
                <div class="chat-messages">Welcome to VideoStream Chat</div>
            </main>

            <div class="chat-form-container">
                <form id="chat-form">
                    <input id="msg" type="text" placeholder="Enter Message" required autocomplete="off" />
                    <button class="btn">Send</button>
                </form>
            </div>
        </div>
    </div>

</body>

<script>

    // $(document).ready(function () {
    //     $('html, body').animate({
    //         scrollTop: $('.hotspot1').offset().top
    //     }, 3000);
    // });


    var getItem = sessionStorage.getItem('token');
    if (!getItem) {
        window.location.href = '/';
    }
    function auditorium() {
        $(".mainscreen").fadeOut(800);
        $(".stream-wrapper").fadeIn(1000);
        // setTimeout(() => {

        // }, 2000);
    }

    function exhibitionhall() {
        window.location.href = '/Live/VirtualReality/ExhibitionHall/'
    }

    function chatboxtoggle() {
        $(".chat-container").toggle();
        // $(".mainscreen").fadeOut(800);
        // // $(".stream-wrapper").fadeOut(1000);
        // $(".chat-container").fadeIn(1000);
    }
    /// for chat js overhere


    const chatForm = document.getElementById('chat-form');
    const chatMessages = document.querySelector('.chat-messages');
    const roomName = document.getElementById('room-name');
    const userList = document.getElementById('users');

    // Get username and room from URL
    // const { username, room } = Qs.parse(location.search, {
    //   ignoreQueryPrefix: true
    // });

    const username = "<%= username %>"
    const room = '<%= stream_name %>';
    
    console.log("chat2.jschat2.jschat2.jschat2.jschat2.jschat2.jschat2.jschat2.jschat2.js");
    console.log(username, room);
    roomName.innerHTML = room;

    // const socket = io();
    // const socket = io.connect('http://localhost:3333/');
    const socket = io.connect('https://vtour.inkincaps.com/');
    
    // const socket = io.connect('https://webinar-iic-1.herokuapp.com/');

    // Join chatroom
    socket.emit('joinRoom', { username, room });

    // Get room and users
    socket.on('roomUsers', ({ room, users }) => {
        outputRoomName(room);
        outputUsers(users);
    });

    // Message from server
    socket.on('message', message => {
        console.log(message);
        outputMessage(message, room);

        // Scroll down
        chatMessages.scrollTop = chatMessages.scrollHeight;
    });

    // Message submit
    chatForm.addEventListener('submit', e => {
        e.preventDefault();

        // Get message text
        const msg = e.target.elements.msg.value;

        // Emit message to server
        socket.emit('chatMessage', { msg, room, });

        // Clear input
        e.target.elements.msg.value = '';
        $(".emojionearea-editor").html('');
        e.target.elements.msg.focus();
    });

    // Output message to DOM
    function outputMessage(message, room) {
        
        console.log(message, room)
        const div = document.createElement('div');
        div.classList.add('message');
        div.innerHTML = `<p class="meta">${message.username} <span style="float:right">${message.time}</span></p>
  <p class="text">
    ${message.text}
  </p>`;
        document.querySelector('.chat-messages').appendChild(div);
    }

    // Add room name to DOM
    function outputRoomName(room) {
        // roomName.innerHTML = room;
    }

    // Add users to DOM
    function outputUsers(users) {
        console.log(users)
        // userList.innerHTML = `
        //   ${users.map(users => `<li>${users.username}</li>`).join('')}
        // `;
        // userList.innerHTML = `<li>${users.username}</li>`
    }
    // showing emojis in input field
    $("#msg").emojioneArea({
        pickerPosition: "top"
    });
</script>

</html>